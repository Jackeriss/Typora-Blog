{% extends "../base.html" %}{% block description %}微博地点热度大数据{% end %}{% block title %}微博地点热度大数据{% end %}{% block section %}<div class="postBlock"><body class="typora-export">
<div class="is-mac" id="write"><h2><a class="md-header-anchor " name="header-c5"></a>微博地点热度大数据</h2><div class="time">                                               <input type="hidden" value="{{                                                timestamp }}"/></div><p>微博有一个地点签到的功能，通过获取某一地区所有地点的历史签到数就可做出这一地区在微博上的热度图。</p><p>首先，你需要一个新浪开发者账号，注册完后创建一个应用，创建时类型选择粉丝服务平台就行了。</p><p>(<a href="http://open.weibo.com/development/fenfu">http://open.weibo.com/development/fenfu</a>    点击右边的创建应用即可)</p><p>然后进到刚才创建的应用的页面，选择应用信息，在基本信息中可以看见以下内容</p><p>App Key：344XXXXXXX
App Secret：577a017XXXXXXXXXXXXXXXXXXXXXXXXX</p><p>应用地址：<a href="https://api.weibo.com/oauth2/default.html" target="_blank">https://api.weibo.com/oauth2/default.html</a></p><p>这些都是使用新浪微博API的基础，有了这些，你只需要根据你所使用的语言下载相应的 SDK 即可放心食用。</p><h4><a class="md-header-anchor " name="header-c24"></a>SDK 使用方法</h4><p>这里仅介绍 Python 的，其他语言类似</p><p>首先，安装 weibo.py 这个模块，使用时将其 import 进来即可。</p><p>具体用法如下：</p><pre class="md-fences md-end-block" lang="python"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px; min-height: 18px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar" style="min-width: 18px;"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment"># -*- coding: utf-8 -*-</span></span></pre></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">weibo</span>  </span></pre><pre class=""><span style="padding-right: 0.1px;">  </span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">APP_KEY</span> = <span class="cm-string">'344XXXXXXX'</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">APP_SECRET</span> = <span class="cm-string">'577a017XXXXXXXXXXXXXXXXXXXXXXXXX'</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">CALL_BACK</span> = <span class="cm-string">'https://api.weibo.com/oauth2/default.html'</span></span></pre><pre class=""><span style="padding-right: 0.1px;">  </span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">client</span> = <span class="cm-variable">weibo</span>.<span class="cm-property">APIClient</span>(<span class="cm-variable">APP_KEY</span>, <span class="cm-variable">APP_SECRET</span>, <span class="cm-variable">CALL_BACK</span>)</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">auth_url</span> = <span class="cm-variable">client</span>.<span class="cm-property">get_authorize_url</span>()</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">print</span> <span class="cm-string">"auth_url : "</span> <span class="cm-operator">+</span> <span class="cm-variable">auth_url</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">code</span> = <span class="cm-builtin">raw_input</span>(<span class="cm-string">"input the retured code : "</span>)</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">r</span> = <span class="cm-variable">client</span>.<span class="cm-property">request_access_token</span>(<span class="cm-variable">code</span>)</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">client</span>.<span class="cm-property">set_access_token</span>(<span class="cm-variable">r</span>.<span class="cm-property">access_token</span>, <span class="cm-variable">r</span>.<span class="cm-property">expires_in</span>)</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">poi_result</span> = <span class="cm-builtin">str</span>(<span class="cm-variable">client</span>.<span class="cm-property">place</span>.<span class="cm-property">nearby</span>.<span class="cm-property">pois</span>.<span class="cm-property">get</span>(<span class="cm-variable">lat</span>=<span class="cm-number">102.700171</span>,<span class="cm-builtin">long</span>=<span class="cm-number">25.057097</span>)) <span class="cm-comment"># 以获取某经纬度附近的地点信息为例</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">print</span> <span class="cm-variable">poi_result</span> <span class="cm-comment"># 此时poi_result是json格式的数据，利用json模块进行解析即可</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 396px;"></div></div></div></pre><p>刚看到微博的地点详情API（place/pois/show）时，我的内心是迷茫的，因为要使用这个API，必须给出你想查询的地点的poiid。</p><h4><a class="md-header-anchor " name="header-c34"></a>什么是 POI ？</h4><p>网上关于 POI 的解释大多是<code>只是白露级驱逐舰夕立的一个口癖，由于夕立的人设很像一个小狗狗，然后就有了稳如 poi 的梗（三步一摔，五步一趟）</code>，实际上这里的 POI 是<code>Point of Interest</code>的缩写，可以翻译成<code>信息点</code>，每个 POI 包含四方面信息，名称、类别、经度纬度以及附近的酒店饭店商铺等信息。</p><h4><a class="md-header-anchor " name="header-c37"></a>如何获取 poiid ?</h4><p>经过一通搜索后发现微博的 API 中有一项的返回值中包含 poiid（place/nearby/pois），然而需要传入你想查询的点的地理坐标，而且返回的是这个坐标附近的 POI 点的信息。</p><p>如此一来问题就变成了如何获得 POI 点的坐标，越精细越好。</p><p>一开始我用 <a href="http://ecomfe.github.io/echarts-map-tool/">EChart 的地图数据生成工具</a>得到了昆明市的一些坐标，我就拿这些坐标去做，做完才发现能够匹配到微博 POI 点的坐标非常少，而且都是一些收费站什么的，有的地方都已经不在昆明了。原来，这个地图数据生成工具生成的只是昆明边界的坐标，而且使用的是百度地图的坐标，而微博使用的是高德地图。</p><p>我这才发现原来各家地图服务商使用的坐标并不相同。目前主要有如下三种坐标系：
大地坐标（WGS84 坐标系）：国际上通用的坐标系。设备一般包含 GPS 芯片或者北斗芯片获取的经纬度为 WGS84 地理坐标系, 谷歌地图采用的是 WGS84 地理坐标系（中国范围除外）。
火星坐标（GCJ02 坐标系）：是由中国国家测绘局制订的地理信息系统的坐标系统。由 WGS84 坐标系经加密后的坐标系。高德地图、谷歌中国地图和搜搜中国地图采用的是 GCJ02 地理坐标系。
百度坐标（BD09 坐标系）：GCJ02 坐标系经加密后的坐标系。</p><p>由于微博使用的是高德地图，这就需要获得高德地图 POI 点的火星坐标。我发现了一个网站可以满足需求：<a href="http://www.poi86.com/">http://www.poi86.com</a>。</p><p>接下来写一个爬虫来爬这些 POI 点的坐标即可。</p></div>
</body><div id="comments"></div><script type="text/javascript">const gitment = new Gitment({id: "wei_bo_di_dian_re_du_da_shu_ju",owner: "Jackeriss",repo: "comments_of_www.jackeriss.com",oauth: {  client_id: "748b4dac7ace16b6d7cb",  client_secret: "c5db352dad6f88b898840d628e44cfb5b4eaf4c0",},});gitment.render("comments")</script>{% end %}