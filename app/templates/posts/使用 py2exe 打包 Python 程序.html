{% extends "../base.html" %}{% block description %}使用 py2exe 打包 Python 程序{% end %}{% block title %}使用 py2exe 打包 Python 程序{% end %}{% block section %}<div class="postBlock"><body class="typora-export">
<div class="is-mac" id="write"><h2><a class="md-header-anchor " name="header-c5"></a>使用 py2exe 打包 Python 程序</h2><div class="time">                                               <input type="hidden" value="{{                                                timestamp }}"/></div><p>py2exe 可以将一个 Python 程序打包成 Windows 下的 exe 可执行文件。使用 py2exe 打包需要编写一个打包脚本，执行后可以得到打包文件。对于 32 位版本，py2exe 可以将程序打包成单文件；对于 64 位版本，暂时还不支持打包成单文件。不过，无论如何压缩，目前 py2exe 打包出来的程序都还是偏大的。</p><h4><a class="md-header-anchor " name="header-c11"></a>参数详解</h4><pre class="md-fences md-end-block" lang="python"> <div class="CodeMirror cm-s-inner CodeMirror-wrap "><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px; min-height: 18px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar" style="min-width: 18px;"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">from</span> <span class="cm-variable">distutils</span>.<span class="cm-property">core</span> <span class="cm-keyword">import</span> <span class="cm-variable">setup</span></span></pre></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">py2exe</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">includes</span> = [<span class="cm-string">"encodings"</span>, <span class="cm-string">"encodings.*"</span>, <span class="cm-string">"sip"</span>]</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">options</span> = {<span class="cm-string">"py2exe"</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;">    {<span class="cm-string">"compressed"</span>: <span class="cm-number">1</span>,</span></pre><pre class=""><span style="padding-right: 0.1px;">     <span class="cm-string">"optimize"</span>: <span class="cm-number">2</span>,</span></pre><pre class=""><span style="padding-right: 0.1px;">     <span class="cm-string">"ascii"</span>: <span class="cm-number">1</span>,</span></pre><div class="" style="position: relative;"><pre class=""><span style="padding-right: 0.1px;">     <span class="cm-string">"includes"</span>: <span class="cm-variable">includes</span>,</span></pre></div><pre class=""><span style="padding-right: 0.1px;">     <span class="cm-string">"bundle_files"</span>: <span class="cm-number">1</span></span></pre><pre class=""><span style="padding-right: 0.1px;">     }</span></pre><pre class=""><span style="padding-right: 0.1px;">    }</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">setup</span>(<span class="cm-variable">options</span>=<span class="cm-variable">options</span>,</span></pre><pre class=""><span style="padding-right: 0.1px;">      <span class="cm-variable">zipfile</span>=<span class="cm-builtin">None</span>,</span></pre><pre class=""><span style="padding-right: 0.1px;">      <span class="cm-variable">windows</span>=[{<span class="cm-string">"script"</span>: <span class="cm-string">"example.py"</span>,</span></pre><pre class=""><span style="padding-right: 0.1px;">                <span class="cm-string">"icon_resources"</span>: [(<span class="cm-number">1</span>, <span class="cm-string">"icon.ico"</span>)]</span></pre><pre class=""><span style="padding-right: 0.1px;">               }],</span></pre><pre class=""><span style="padding-right: 0.1px;">      <span class="cm-comment">#data_files=[("*",["#","#","#"]),]</span></span></pre><pre class=""><span style="padding-right: 0.1px;">     )</span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 440px;"></div></div></div></pre><p>选项中<code>includes</code>是需要包含的文件，这里的<code>sip</code>是 PyQt 程序打包时需要添加的，如果不是 PyQt 程序不需要此项。</p><p><code>dll_excludes</code>是需要排除的 dll 文件，如果什么都不写，有可能会报<code>error: MSVCP90.dll: No such file or directory</code>错误。你可以在微软官网下载一个<code>MSVCP90.dll</code>并将其放入系统路径内。</p><p><code>compressed</code>为 1，则压缩文件。</p><p><code>ptimize</code>为优化级别，默认为 0。</p><p><code>ascii</code>指<strong>不</strong>自动包含 encodings 和 codecs。</p><p><code>bundle_files</code>是指将程序打包成单文件（此时除了 exe 文件外，还会生成一个 zip 文件。如果不需要 zip 文件，还需要设置<code>zipfile = None</code>）。1表示 pyd 和 dll 文件会被打包到单文件中，且不能从文件系统中加载 Python 模块；值为2表示 pyd 和 dll 文件会被打包到单文件中，但是可以从文件系统中加载 Python 模块。<strong>64 位的 py2exe 不要添加本句</strong>。</p><pre class="md-fences md-end-block" lang="python"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px; min-height: 18px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar" style="min-width: 18px;"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">windows</span>=[{<span class="cm-string">"script"</span>: <span class="cm-string">"example.py"</span>,</span></pre></div><pre class=""><span style="padding-right: 0.1px;">          <span class="cm-string">"icon_resources"</span>: [(<span class="cm-number">1</span>, <span class="cm-string">"icon.ico"</span>)]</span></pre><pre class=""><span style="padding-right: 0.1px;">         }]</span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 66px;"></div></div></div></pre><p>这里使用的是<code>windows</code>，即没有命令行窗口出现，如果使用<code>console</code>则表示有命令行窗口出现。</p><p><code>script</code>是你要打包的程序的执行入口文件。</p><p><code>icon_resources</code>可以设置打包生成的 exe 文件的图标。</p><p><code>data_files</code>中可以添加一起打包的文件，在<code>*</code>处写文件夹路径，在<code>#</code>处写要一起打包的文件名。</p><p>执行该文件，会得到一个 build 文件夹和一个 dist 文件夹。其中，dist 文件夹，就是你得到的打包程序。</p><p>如果按照上述代码执行成功，则应该 dist 文件夹中，只包括程序的 exe 文件和w9xpopen.exe。w9xpopen.exe 是针对 windows 9x 版本的，一般来说该文件并不需要。</p><p>如果<code>bundle_files</code>不为 1、2，则 dist 文件夹中还会包括一些 dll 文件和 pyd 文件。如果<code>bundle_files</code>为 2，dist 文件夹会包括一个 python##.dll 文件，如果为 1 则不会。</p><p>如果没有使用<code>zipfile=None</code>，还会生成一个 library.zip 文件。</p><h4><a class="md-header-anchor " name="header-c42"></a>常见问题</h4><p>Windows Vista 以上版本的系统下图标显示异常</p><p>按照上面的代码打包来的 exe 程序，在 windows XP 系统下，我们可以看到 exe 的图标。但是当把程序拷贝到 vista/win7 下时，exe 图标确变成了默认的”窗口“图标，无论怎么变换试图模式都使如此。</p><p>首先先介绍一下 ico 文件，这对于理解其解决方案有很大帮助。</p><p>ico 文件是 Windows 下图片格式，我们看到的文件夹，执行文件等都有不同的图标显示，并且当我们切换视图模式时，文件的图标会以”不同“尺寸显示，确切的说，应该是不同的图标文件（尺寸亦不同）。ico 文件里面可以有多个不同的图标文件以适应不同的视图模式，并且这些图标文件通常按尺寸大小的顺序存放。以 Windows XP 下支持的 ico 尺寸为 16 x 16，32 x 32 和 48 x 48。Vista 以上的系统下则最多可以支持 256 x 256。</p><p>问题关键在于 ico 文件中图标的顺序问题，XP 对顺序要求不高，无论是图标是按尺寸的正序还是倒序都可以正常显示，而然在 Vista 以上的系统下确只能倒序。</p><p>推荐几个 ico 编辑工具来解决这个问题，首先是 Greenfish Icon Editor Pro，该工具不仅可以编辑图标文件，而且可以修改图标文件的顺序。然后 IcoFX 也有类似的功能。最后就是 Icon Manager，这个小工具专门用来修改 ico 文件的图片顺序。</p></div>
</body><div id="comments"></div><script type="text/javascript">const gitment = new Gitment({id: "shi_yong_py2exe_da_bao_Python_cheng_xu",owner: "Jackeriss",repo: "comments_of_www.jackeriss.com",oauth: {  client_id: "748b4dac7ace16b6d7cb",  client_secret: "c5db352dad6f88b898840d628e44cfb5b4eaf4c0",},});gitment.render("comments")</script>{% end %}