{% extends "../base.html" %}{% block description %}Linux 标准输出编码问题{% end %}{% block title %}Linux 标准输出编码问题{% end %}{% block section %}<div class="postBlock"><body class="typora-export">
<div class="is-mac" id="write"><h2><a class="md-header-anchor " name="header-n0"></a>Linux 标准输出编码问题</h2><div class="time">                                               <input type="hidden" value="{{                                                timestamp }}"/></div><p></p><div class="a">最近遇到了一个编码问题，新换了台服务器后，代码在本地运行正常，可部署到服务器上就出现编码错误。初步判断是系统的编码问题，以下测试证实了我的想法：<pre class="md-fences md-end-block" lang="python"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px; min-height: 18px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar" style="min-width: 18px;"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><div style="width: 50px; height: 50px; overflow-x: scroll;"></div></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">sys</span></span></pre></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">print</span>(<span class="cm-variable">sys</span>.<span class="cm-property">getdefaultencoding</span>())</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">print</span>(<span class="cm-variable">sys</span>.<span class="cm-property">stdout</span>.<span class="cm-property">encoding</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 66px;"></div></div></div></pre><p></p></div><p>执行结果：</p><pre class="md-fences mock-cm" style="display:block;position:relative">UTF-8
ANSI_X3.4-1968</pre><p>如果在系统环境变量中没有设置 LC_ALL 的话 Linux 会使用 ANSI X3.4-1968 作为标准输出的编码。</p><p>最终我通过为系统添加环境变量的方法解决了这个问题：</p><p>首先执行 <code>vi /etc/profile</code> ，然后在文件的末尾添加以下内容：</p><pre class="md-fences mock-cm" style="display:block;position:relative">export LC_ALL="en_US.UTF-8"
export LANG="en_US.UTF-8"</pre><p>如果想让系统使用中文语言则改为 <code>zh_CN.UTF-8</code> 。 </p><p>保存文件后执行 <code>source /etc/profile</code> 来让更改立即生效。</p></div>
</body>{% end %}