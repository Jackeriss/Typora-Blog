{% extends "../base.html" %}{% block description %}Python 发送与接收邮件{% end %}{% block title %}Python 发送与接收邮件{% end %}{% block section %}<div class="postBlock"><body class="typora-export">
<div class="is-mac" id="write"><h2><a class="md-header-anchor " name="header-c5"></a>Python 发送与接收邮件</h2><div class="time">                                               <input type="hidden" value="{{                                                timestamp }}"/></div><p>只用 Python 标准库就可以实现邮件收发功能。我将具体的实现方法总结了一下，现在分享给大家。</p><h4><a class="md-header-anchor " name="header-c11"></a>邮件发送</h4><pre class="md-fences md-end-block" lang="python"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px; min-height: 18px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar" style="min-width: 18px;"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment"># -*- coding: utf-8 -*-</span></span></pre></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">smtplib</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">os</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">from</span> <span class="cm-variable">email</span>.<span class="cm-property">mime</span>.<span class="cm-property">multipart</span> <span class="cm-keyword">import</span> <span class="cm-variable">MIMEMultipart</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">from</span> <span class="cm-variable">email</span>.<span class="cm-property">mime</span>.<span class="cm-property">text</span> <span class="cm-keyword">import</span> <span class="cm-variable">MIMEText</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">from</span> <span class="cm-variable">email</span>.<span class="cm-property">mime</span>.<span class="cm-property">image</span> <span class="cm-keyword">import</span> <span class="cm-variable">MIMEImage</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-string">"""</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-string">    smtpserver = 发件邮箱的 SMTP 服务器地址</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-string">    smtpport = 发件邮箱的 SMTP 服务器端口</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-string">    user = 发件人邮箱</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-string">    mailto = 收件人邮箱</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-string">    passwd = 发件人邮箱授权密码</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-string">    title = 邮件主题</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-string">    msg = 邮件文本内容（支持 HTML）</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-string">    file_name = 邮件附件名（请将附件存放在本文件同级目录）</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-string">"""</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">def</span> <span class="cm-def">send</span>(<span class="cm-variable">smtpserver</span>, <span class="cm-variable">smtpport</span>, <span class="cm-variable">user</span>, <span class="cm-variable">mailto</span>, <span class="cm-variable">passwd</span>, <span class="cm-variable">title</span>, <span class="cm-variable">msg</span>=<span class="cm-builtin">None</span>, <span class="cm-variable">file_name</span>=<span class="cm-builtin">None</span>):</span></pre><pre class=""><span style="padding-right: 0.1px;">    <span class="cm-variable">msgRoot</span> = <span class="cm-variable">MIMEMultipart</span>(<span class="cm-string">'related'</span>)</span></pre><pre class=""><span style="padding-right: 0.1px;">    <span class="cm-variable">msgRoot</span>[<span class="cm-string">'From'</span>] = <span class="cm-string">"Jackeriss"</span> <span class="cm-comment"># 发件人名称</span></span></pre><pre class=""><span style="padding-right: 0.1px;">    <span class="cm-variable">msgRoot</span>[<span class="cm-string">'Subject'</span>] = <span class="cm-variable">title</span> <span class="cm-comment"># 邮件主题（题目</span></span></pre><pre class=""><span style="padding-right: 0.1px;">    <span class="cm-keyword">if</span> <span class="cm-variable">msg</span> <span class="cm-operator">!</span>= <span class="cm-builtin">None</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;">        <span class="cm-variable">msgText</span> = <span class="cm-variable">MIMEText</span>(<span class="cm-string">'%s'</span> <span class="cm-operator">%</span> <span class="cm-variable">msg</span>, <span class="cm-string">'html'</span>, <span class="cm-string">'utf-8'</span>) <span class="cm-comment"># HTML 格式的邮件内容</span></span></pre><pre class=""><span style="padding-right: 0.1px;">        <span class="cm-variable">msgRoot</span>.<span class="cm-property">attach</span>(<span class="cm-variable">msgText</span>)</span></pre><pre class=""><span style="padding-right: 0.1px;">    <span class="cm-keyword">if</span> <span class="cm-variable">file_name</span> <span class="cm-operator">!</span>= <span class="cm-builtin">None</span>: <span class="cm-comment"># 邮件的附件</span></span></pre><pre class=""><span style="padding-right: 0.1px;">        <span class="cm-variable">att</span> = <span class="cm-variable">MIMEText</span>(<span class="cm-builtin">open</span>(<span class="cm-string">'%s'</span> <span class="cm-operator">%</span> <span class="cm-variable">file_name</span>, <span class="cm-string">'rb'</span>).<span class="cm-property">read</span>(), <span class="cm-string">'base64'</span>, <span class="cm-string">'utf-8'</span>)</span></pre><pre class=""><span style="padding-right: 0.1px;">        <span class="cm-variable">att</span>[<span class="cm-string">"Content-Type"</span>] = <span class="cm-string">'application/octet-stream'</span></span></pre><pre class=""><span style="padding-right: 0.1px;">        <span class="cm-variable">att</span>[<span class="cm-string">"Content-Disposition"</span>] = <span class="cm-string">'attachment; filename="%s"'</span> <span class="cm-operator">%</span> <span class="cm-variable">file_name</span></span></pre><pre class=""><span style="padding-right: 0.1px;">        <span class="cm-variable">msgRoot</span>.<span class="cm-property">attach</span>(<span class="cm-variable">att</span>)</span></pre><pre class=""><span style="padding-right: 0.1px;">    <span class="cm-variable">try_num</span> = <span class="cm-number">0</span> <span class="cm-comment"># 尝试发送邮件计数</span></span></pre><pre class=""><span style="padding-right: 0.1px;">    <span class="cm-variable">try_max</span> = <span class="cm-number">10</span> <span class="cm-comment"># 尝试发送邮件最高次数</span></span></pre><pre class=""><span style="padding-right: 0.1px;">    <span class="cm-keyword">while</span> <span class="cm-number">1</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;">        <span class="cm-variable">try_num</span> += <span class="cm-number">1</span></span></pre><pre class=""><span style="padding-right: 0.1px;">        <span class="cm-keyword">try</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;">            <span class="cm-variable">smtp</span>.<span class="cm-property">sendmail</span>(<span class="cm-variable">user</span>, <span class="cm-variable">mailto</span>, <span class="cm-variable">msgRoot</span>.<span class="cm-property">as_string</span>())</span></pre><pre class=""><span style="padding-right: 0.1px;">            <span class="cm-keyword">break</span></span></pre><pre class=""><span style="padding-right: 0.1px;">        <span class="cm-keyword">except</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;">            <span class="cm-keyword">try</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;">                <span class="cm-comment"># 绝大多数邮箱不开启加密时的 SMTP 端口为 25</span></span></pre><pre class=""><span style="padding-right: 0.1px;">                <span class="cm-keyword">if</span> <span class="cm-variable">smtpport</span> == <span class="cm-string">'25'</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;">                    <span class="cm-variable">smtp</span> = <span class="cm-variable">smtplib</span>.<span class="cm-property">SMTP</span>(<span class="cm-variable">smtpserver</span>, <span class="cm-variable">smtpport</span>)</span></pre><pre class=""><span style="padding-right: 0.1px;">                <span class="cm-comment"># 587 端口常用作 TLS 加密</span></span></pre><pre class=""><span style="padding-right: 0.1px;">                <span class="cm-keyword">elif</span> <span class="cm-variable">smtpport</span> == <span class="cm-string">'587'</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;">                    <span class="cm-variable">smtp</span> = <span class="cm-variable">smtplib</span>.<span class="cm-property">SMTP</span>(<span class="cm-variable">smtpserver</span>, <span class="cm-variable">smtpport</span>)</span></pre><pre class=""><span style="padding-right: 0.1px;">                    <span class="cm-variable">smtp</span>.<span class="cm-property">ehlo</span>()</span></pre><pre class=""><span style="padding-right: 0.1px;">                    <span class="cm-variable">smtp</span>.<span class="cm-property">starttls</span>()</span></pre><pre class=""><span style="padding-right: 0.1px;">                    <span class="cm-variable">smtp</span>.<span class="cm-property">ehlo</span>()</span></pre><pre class=""><span style="padding-right: 0.1px;">                <span class="cm-comment"># 其他端口视为 SSL 加密端口</span></span></pre><pre class=""><span style="padding-right: 0.1px;">                <span class="cm-keyword">else</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;">                    <span class="cm-variable">smtp</span> = <span class="cm-variable">smtplib</span>.<span class="cm-property">SMTP_SSL</span>(<span class="cm-variable">smtpserver</span>, <span class="cm-variable">smtpport</span>)</span></pre><pre class=""><span style="padding-right: 0.1px;">                <span class="cm-variable">smtp</span>.<span class="cm-property">login</span>(<span class="cm-variable">user</span>, <span class="cm-variable">passwd</span>)</span></pre><pre class=""><span style="padding-right: 0.1px;">            <span class="cm-keyword">except</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;">                <span class="cm-keyword">if</span> <span class="cm-variable">try_num</span> <span class="cm-operator">&gt;</span> <span class="cm-variable">try_max</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;">                    <span class="cm-keyword">break</span></span></pre><pre class=""><span style="padding-right: 0.1px;">                <span class="cm-keyword">pass</span></span></pre><pre class=""><span style="padding-right: 0.1px;">    <span class="cm-keyword">if</span> <span class="cm-variable">file_name</span> <span class="cm-operator">!</span>= <span class="cm-builtin">None</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;">        <span class="cm-variable">path</span> = <span class="cm-variable">os</span>.<span class="cm-property">path</span>.<span class="cm-property">join</span>(<span class="cm-variable">os</span>.<span class="cm-property">getcwd</span>(), <span class="cm-variable">file_name</span>)</span></pre><pre class=""><span style="padding-right: 0.1px;">        <span class="cm-keyword">if</span> <span class="cm-variable">os</span>.<span class="cm-property">path</span>.<span class="cm-property">exists</span>(<span class="cm-variable">path</span>):</span></pre><pre class=""><span style="padding-right: 0.1px;">            <span class="cm-variable">os</span>.<span class="cm-property">remove</span>(<span class="cm-variable">path</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 1298px;"></div></div></div></pre><h4><a class="md-header-anchor " name="header-c13"></a>邮件接收</h4><pre class="md-fences md-end-block md-focus" lang="python"> <div class="CodeMirror cm-s-inner CodeMirror-wrap CodeMirror-focused"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 968px; left: 20px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px; min-height: 18px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar" style="min-width: 18px;"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" style=""><div class="" style="position: relative;"><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment"># -*- coding: utf-8 -*-</span></span></pre></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">time</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">poplib</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">from</span> <span class="cm-variable">email</span>.<span class="cm-property">parser</span> <span class="cm-keyword">import</span> <span class="cm-variable">Parser</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">from</span> <span class="cm-variable">email</span>.<span class="cm-property">header</span> <span class="cm-keyword">import</span> <span class="cm-variable">decode_header</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">from</span> <span class="cm-variable">email</span>.<span class="cm-property">utils</span> <span class="cm-keyword">import</span> <span class="cm-variable">parseaddr</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><div class="" style="position: relative;"><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment"># 解析新邮件，获取其中的信息</span></span></pre></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">def</span> <span class="cm-def">get_info</span>(<span class="cm-variable">msg</span>, <span class="cm-variable">indent</span>=<span class="cm-number">0</span>):</span></pre><pre class=""><span style="padding-right: 0.1px;">    <span class="cm-variable">subject</span> = <span class="cm-string">''</span></span></pre><pre class=""><span style="padding-right: 0.1px;">    <span class="cm-variable">addr</span> = <span class="cm-string">''</span></span></pre><pre class=""><span style="padding-right: 0.1px;">    <span class="cm-variable">content</span> = <span class="cm-string">''</span></span></pre><pre class=""><span style="padding-right: 0.1px;">    <span class="cm-keyword">if</span> <span class="cm-variable">indent</span> == <span class="cm-number">0</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;">        <span class="cm-keyword">for</span> <span class="cm-variable">header</span> <span class="cm-keyword">in</span> [<span class="cm-string">'From'</span>, <span class="cm-string">'Subject'</span>]:</span></pre><pre class=""><span style="padding-right: 0.1px;">            <span class="cm-variable">value</span> = <span class="cm-variable">msg</span>.<span class="cm-property">get</span>(<span class="cm-variable">header</span>, <span class="cm-string">''</span>)</span></pre><pre class=""><span style="padding-right: 0.1px;">            <span class="cm-keyword">if</span> <span class="cm-variable">value</span>:</span></pre><div class="" style="position: relative;"><pre class=""><span style="padding-right: 0.1px;">                <span class="cm-keyword">if</span> <span class="cm-variable">header</span> == <span class="cm-string">'Subject'</span>:</span></pre></div><pre class=""><span style="padding-right: 0.1px;">                    <span class="cm-variable">subject</span> = <span class="cm-variable">decode_str</span>(<span class="cm-variable">value</span>)</span></pre><pre class=""><span style="padding-right: 0.1px;">                <span class="cm-keyword">else</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;">                    <span class="cm-variable">hdr</span>, <span class="cm-variable">addr</span> = <span class="cm-variable">parseaddr</span>(<span class="cm-variable">value</span>)</span></pre><pre class=""><span style="padding-right: 0.1px;">    <span class="cm-keyword">if</span> <span class="cm-variable">msg</span>.<span class="cm-property">is_multipart</span>():</span></pre><pre class=""><span style="padding-right: 0.1px;">        <span class="cm-variable">parts</span> = <span class="cm-variable">msg</span>.<span class="cm-property">get_payload</span>()</span></pre><pre class=""><span style="padding-right: 0.1px;">        <span class="cm-keyword">for</span> <span class="cm-variable">n</span>, <span class="cm-variable">part</span> <span class="cm-keyword">in</span> <span class="cm-builtin">enumerate</span>(<span class="cm-variable">parts</span>):</span></pre><pre class=""><span style="padding-right: 0.1px;">            <span class="cm-variable">content_value</span> = <span class="cm-variable">get_info</span>(<span class="cm-variable">part</span>, <span class="cm-variable">indent</span> <span class="cm-operator">+</span> <span class="cm-number">1</span>)[<span class="cm-number">2</span>]</span></pre><pre class=""><span style="padding-right: 0.1px;">            <span class="cm-keyword">if</span> <span class="cm-variable">content_value</span> <span class="cm-operator">!</span>= <span class="cm-string">''</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;">                <span class="cm-variable">content</span> = <span class="cm-variable">content_value</span></span></pre><pre class=""><span style="padding-right: 0.1px;">    <span class="cm-keyword">else</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;">        <span class="cm-variable">content_type</span> = <span class="cm-variable">msg</span>.<span class="cm-property">get_content_type</span>()</span></pre><div class="" style="position: relative;"><pre class=""><span style="padding-right: 0.1px;">        <span class="cm-keyword">if</span> <span class="cm-variable">content_type</span> == <span class="cm-string">'text/plain'</span>:</span></pre></div><pre class=""><span style="padding-right: 0.1px;">            <span class="cm-variable">content</span> = <span class="cm-variable">msg</span>.<span class="cm-property">get_payload</span>(<span class="cm-variable">decode</span>=<span class="cm-builtin">True</span>)</span></pre><pre class=""><span style="padding-right: 0.1px;">            <span class="cm-variable">charset</span> = <span class="cm-variable">guess_charset</span>(<span class="cm-variable">msg</span>)</span></pre><pre class=""><span style="padding-right: 0.1px;">            <span class="cm-keyword">if</span> <span class="cm-variable">charset</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;">                <span class="cm-variable">content</span> = <span class="cm-variable">content</span>.<span class="cm-property">decode</span>(<span class="cm-variable">charset</span>)</span></pre><pre class=""><span style="padding-right: 0.1px;">        <span class="cm-keyword">else</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;">            <span class="cm-variable">content</span> = <span class="cm-string">''</span></span></pre><pre class=""><span style="padding-right: 0.1px;">    <span class="cm-keyword">return</span> (<span class="cm-variable">subject</span>, <span class="cm-variable">addr</span>, <span class="cm-variable">content</span>)</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><div class="" style="position: relative;"><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment"># 解决邮件中的编码问题</span></span></pre></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">def</span> <span class="cm-def">decode_str</span>(<span class="cm-variable">s</span>):</span></pre><pre class=""><span style="padding-right: 0.1px;">    <span class="cm-variable">value</span>, <span class="cm-variable">charset</span> = <span class="cm-variable">decode_header</span>(<span class="cm-variable">s</span>)[<span class="cm-number">0</span>]</span></pre><pre class=""><span style="padding-right: 0.1px;">    <span class="cm-keyword">if</span> <span class="cm-variable">charset</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;">        <span class="cm-variable">value</span> = <span class="cm-variable">value</span>.<span class="cm-property">decode</span>(<span class="cm-variable">charset</span>)</span></pre><pre class=""><span style="padding-right: 0.1px;">    <span class="cm-keyword">return</span> <span class="cm-variable">value</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre><span style="padding-right: 0.1px;"><span class="cm-comment"># 获取邮件的编码信息</span></span></pre></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">def</span> <span class="cm-def">guess_charset</span>(<span class="cm-variable">msg</span>):</span></pre><pre class=""><span style="padding-right: 0.1px;">    <span class="cm-variable">charset</span> = <span class="cm-variable">msg</span>.<span class="cm-property">get_charset</span>()</span></pre><pre class=""><span style="padding-right: 0.1px;">    <span class="cm-keyword">if</span> <span class="cm-variable">charset</span> <span class="cm-keyword">is</span> <span class="cm-builtin">None</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;">        <span class="cm-variable">content_type</span> = <span class="cm-variable">msg</span>.<span class="cm-property">get</span>(<span class="cm-string">'Content-Type'</span>, <span class="cm-string">''</span>).<span class="cm-property">lower</span>()</span></pre><pre class=""><span style="padding-right: 0.1px;">        <span class="cm-variable">pos</span> = <span class="cm-variable">content_type</span>.<span class="cm-property">find</span>(<span class="cm-string">'charset='</span>)</span></pre><pre class=""><span style="padding-right: 0.1px;">        <span class="cm-keyword">if</span> <span class="cm-variable">pos</span> <span class="cm-operator">&gt;</span>= <span class="cm-number">0</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;">            <span class="cm-variable">charset</span> = <span class="cm-variable">content_type</span>[<span class="cm-variable">pos</span> <span class="cm-operator">+</span> <span class="cm-number">8</span>:].<span class="cm-property">strip</span>()</span></pre><pre class=""><span style="padding-right: 0.1px;">    <span class="cm-keyword">return</span> <span class="cm-variable">charset</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">if</span> <span class="cm-variable">__name__</span> == <span class="cm-string">"__main__"</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;">    <span class="cm-variable">popserver</span> = <span class="cm-string">""</span> <span class="cm-comment"># POP3 服务器地址</span></span></pre><pre class=""><span style="padding-right: 0.1px;">    <span class="cm-variable">popport</span> = <span class="cm-string">""</span> <span class="cm-comment"># POP3 服务器端口</span></span></pre><pre class=""><span style="padding-right: 0.1px;">    <span class="cm-variable">user</span> = <span class="cm-string">""</span> <span class="cm-comment"># 邮箱用户名</span></span></pre><pre class=""><span style="padding-right: 0.1px;">    <span class="cm-variable">passwd</span> = <span class="cm-string">""</span> <span class="cm-comment"># 邮箱授权密码</span></span></pre><pre class=""><span style="padding-right: 0.1px;">    <span class="cm-keyword">while</span> <span class="cm-number">1</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;">        <span class="cm-keyword">try</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;">            <span class="cm-keyword">if</span> <span class="cm-variable">popport</span> == <span class="cm-string">'110'</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;">                <span class="cm-variable">p</span> = <span class="cm-variable">poplib</span>.<span class="cm-property">POP3</span>(<span class="cm-variable">popserver</span>, <span class="cm-variable">popport</span>)</span></pre><pre class=""><span style="padding-right: 0.1px;">            <span class="cm-keyword">else</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;">                <span class="cm-variable">p</span> = <span class="cm-variable">poplib</span>.<span class="cm-property">POP3_SSL</span>(<span class="cm-variable">popserver</span>, <span class="cm-variable">popport</span>)</span></pre><pre class=""><span style="padding-right: 0.1px;">            <span class="cm-keyword">except</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;">                <span class="cm-keyword">print</span> <span class="cm-string">"pop sever error"</span></span></pre><pre class=""><span style="padding-right: 0.1px;">        <span class="cm-keyword">else</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;">            <span class="cm-keyword">try</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;">                <span class="cm-variable">p</span>.<span class="cm-property">user</span>(<span class="cm-variable">user</span>)</span></pre><pre class=""><span style="padding-right: 0.1px;">                <span class="cm-variable">p</span>.<span class="cm-property">pass_</span>(<span class="cm-variable">passwd</span>)</span></pre><pre class=""><span style="padding-right: 0.1px;">            <span class="cm-keyword">except</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;">                <span class="cm-keyword">print</span> <span class="cm-string">"pop login error"</span></span></pre><pre class=""><span style="padding-right: 0.1px;">            <span class="cm-keyword">else</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;">                <span class="cm-keyword">try</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;">                    <span class="cm-variable">resp</span>, <span class="cm-variable">mails</span>, <span class="cm-variable">octets</span> = <span class="cm-variable">p</span>.<span class="cm-property">list</span>()</span></pre><pre class=""><span style="padding-right: 0.1px;">                    <span class="cm-variable">number</span> = <span class="cm-builtin">len</span>(<span class="cm-variable">mails</span>)</span></pre><pre class=""><span style="padding-right: 0.1px;">                    <span class="cm-keyword">if</span> <span class="cm-variable">number</span> <span class="cm-operator">!</span>= <span class="cm-variable">pre_number</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;">                        <span class="cm-keyword">if</span> <span class="cm-variable">pre_number</span> <span class="cm-operator">!</span>= <span class="cm-operator">-</span><span class="cm-number">1</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;">                            <span class="cm-variable">resp</span>, <span class="cm-variable">lines</span>, <span class="cm-variable">octets</span> = <span class="cm-variable">p</span>.<span class="cm-property">retr</span>(<span class="cm-variable">number</span>)</span></pre><pre class=""><span style="padding-right: 0.1px;">                            <span class="cm-variable">msg_content</span> = <span class="cm-string">b'\r\n'</span>.<span class="cm-property">join</span>(<span class="cm-variable">lines</span>)</span></pre><pre class=""><span style="padding-right: 0.1px;">                            <span class="cm-variable">msg</span> = <span class="cm-variable">Parser</span>().<span class="cm-property">parsestr</span>(<span class="cm-variable">msg_content</span>)</span></pre><pre class=""><span style="padding-right: 0.1px;">                            <span class="cm-variable">info</span> = <span class="cm-variable">get_info</span>(<span class="cm-variable">msg</span>)</span></pre><pre class=""><span style="padding-right: 0.1px;">                            <span class="cm-variable">subject</span> = <span class="cm-variable">info</span>[<span class="cm-number">0</span>].<span class="cm-property">strip</span>()</span></pre><pre class=""><span style="padding-right: 0.1px;">                            <span class="cm-variable">addr</span> = <span class="cm-variable">info</span>[<span class="cm-number">1</span>].<span class="cm-property">strip</span>()</span></pre><pre class=""><span style="padding-right: 0.1px;">                            <span class="cm-variable">content</span> = <span class="cm-variable">info</span>[<span class="cm-number">2</span>].<span class="cm-property">strip</span>()</span></pre><pre class=""><span style="padding-right: 0.1px;">                            <span class="cm-keyword">print</span> <span class="cm-variable">subject</span>, <span class="cm-variable">addr</span>, <span class="cm-variable">content</span></span></pre><pre class=""><span style="padding-right: 0.1px;">                <span class="cm-keyword">except</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;">                    <span class="cm-keyword">print</span> <span class="cm-string">"error in sending"</span></span></pre><pre class=""><span style="padding-right: 0.1px;">                <span class="cm-keyword">try</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;">                    <span class="cm-variable">p</span>.<span class="cm-property">quit</span>()</span></pre><pre class=""><span style="padding-right: 0.1px;">                <span class="cm-keyword">except</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;">                    <span class="cm-keyword">print</span> <span class="cm-string">"quit error"</span></span></pre><pre class=""><span style="padding-right: 0.1px;">        <span class="cm-variable">time</span>.<span class="cm-property">sleep</span>(<span class="cm-number">5</span>)</span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 2068px;"></div></div></div></pre><p></p></div>
</body><div id="comments"></div><script type="text/javascript">const gitment = new Gitment({id: "Python_fa_song_与_jie_shou_you_jian",owner: "Jackeriss",repo: "comments_of_www.jackeriss.com",oauth: {  client_id: "748b4dac7ace16b6d7cb",  client_secret: "c5db352dad6f88b898840d628e44cfb5b4eaf4c0",},});gitment.render("comments")</script>{% end %}